---
# define intervals and escalations
# in your Check resource
apiVersion: "crd.k8s.afrank.local/v1"
kind: Check
metadata:
  name: check-ssh-observatory-pending-check
  namespace: mozalert-prod
  labels:
    team: eis
    type: mozlenium
spec:
  check_interval: 5m
  retry_interval: 3m
  notification_interval: 15m
  max_attempts: 3
  image: afrank/mozlenium
  check_cm: check-ssh-observatory-pending-check-cm

---
# here is the check itself, stored in a configmap
# this block was generated with 
# k create configmap check-test-1-cm --from-file=./check.js
kind: ConfigMap
apiVersion: v1
metadata:
  name: check-ssh-observatory-pending-check-cm
  namespace: mozalert-prod
data:
  check.js: |+
    /**
     * Feel free to explore, or check out the full documentation
     * https://docs.newrelic.com/docs/synthetics/new-relic-synthetics/scripting-monitors/writing-api-tests
     * for details.
     */
    
    var assert = require('assert');
    var $http = require('request');
    
    $http.get('https://sshscan.rubidus.com/api/v1/stats',
      // Callback
      function (err, response, body) {
        assert.equal(response.statusCode, 200, 'Expected a 200 OK response');
    
        var response_info = JSON.parse(body);
        assert(response_info.SCAN_STATES.QUEUED >= 0, 'SCAN_STATES.QUEUED is greater or equal to 0');
        assert(response_info.SCAN_STATES.QUEUED <= 25, 'SCAN_STATES.QUEUED  is greater or equal to 0');
      }
    );

